<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>login</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="main">
        <div id="background"></div>
        <div class="navbar">
            <img class="LOGO">
        </div>
        <div class="login">
            <img class="LOGO">
            <div>
                <form id="login-form">
                    <input class="in" type="text" placeholder="用户名" id="username" required>
                    <input class="in" type="password" placeholder="密码" id="password" required>
                    <button class = "in" type="submit" onclick="ajaxHttpRequestFunc()">用户名登录</button>
                </form>
                <p class="message" id="verification-message"></p>

                <p class = "account" id="text">没有账号？</p>
                <a href="../sign-up/sign-up.html" class = "account" id="sign-up">注册账号</a>
                <a href="../reset-password/reset-password.html" class = "account" id="forget-password">忘记密码</a>
                <div class="container">
                    <div class="item line" id="line-one"></div>
                    <div class="item para" ><p>或者</p></div>
                    <div class="item line" id="line-two"></div>
                </div>
                <button onclick="RedirectToPage()" class = "in" type="button">使用邮箱登录</button>
                <script>
                    function ajaxHttpRequestFunc(){
                        let xmlHttpRequest;  // 创建XMLHttpRequest对象，即一个用于保存异步调用对象的变量
                        if(window.ActiveXObject){ // IE浏览器的创建方式
                            xmlHttpRequest = new ActiveXObject("Microsoft.XMLHTTP");
                        }else if(window.XMLHttpRequest){ // Netscape浏览器中的创建方式
                            xmlHttpRequest = new XMLHttpRequest();
                        }
                        xmlHttpRequest.onreadystatechange=function(){ // 设置响应http请求状态变化的事件
                            if(xmlHttpRequest.readyState == 4){ // 判断异步调用是否成功,若成功开始局部更新数据
                                let jsonResult=JSON.parse(xmlHttpRequest.responseText);
                                let message = document.getElementById("verification-message");
                                if(xmlHttpRequest.status == 200) {
                                    message.textContent = jsonResult.message;
                                    message.style.color = "green";
                                    window.location.href = "index.html";
                                } else {
                                    message.textContent = jsonResult.message;
                                    message.style.color = "red";
                                }
                            }else{
                                message.textContent = "发送不成功";
                                message.style.color = "red";
                            }
                        }
                        let username = document.getElementById("username").value;
                        let password = document.getElementById("password").value;
                        /*let requestData = { username: username, password: password };
                        requestData=JSON.stringify(requestData);*/
                        xmlHttpRequest.open("GET","http://localhost:8080/login?username="+username+"&password="+password,true); // 创建http请求，并指定请求得方法（get）、url（https://www.runoob.com/try/ajax/ajax_info.txt）以及验证信息
                        xmlHttpRequest.send(null); // 发送请求
                    }
                    function RedirectToPage() {
                        window.location.href = "email-login.html";
                    }
                    function validateLogin(event) {
                        event.preventDefault(); // Prevent form submission
                        var username = document.getElementById("username").value;
                        var password = document.getElementById("password").value;
                        var message = document.getElementById("verification-message");
                        if (username === "admin" && password === "password") {
                            message.textContent = "登录成功";
                            message.style.color = "green";
                            window.location.href = "../../index.html";
                        } else {
                            message.textContent = "账号或者密码错误";
                            message.style.color = "red";
                        }
                    }
                    document.getElementById("login-form").addEventListener("submit", ajaxHttpRequestFunc);
                </script>
            </div>
        </div>
    </div>
</body>
</html>
